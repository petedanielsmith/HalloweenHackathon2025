{% extends "base.html" %}

{% block title %}
Events • Spooky Experiences
{% endblock %}

{% block content %}
<h1 class="mb-4 text-center">Events</h1>

<!-- FILTER BAR -->
 <form method="get" 
      class="row g-3 align-items-end mb-5 p-4 rounded-4 shadow-sm"
      style="background: linear-gradient(145deg, #1a1924 0%, #0d0c13 100%); border: 1px solid rgba(255, 193, 7, 0.65); margin-top: 10px;">

  <!-- Search -->
  <div class="col-12 col-md-4">
    <label class="form-label text-warning fw-semibold">Search</label>
    <input
      type="text"
      name="q"
      value="{{ request.GET.q }}"
      class="form-control bg-dark text-light border-secondary"
      placeholder="Search by title or location..."
    />
  </div>

  <!-- Min Rating -->
  <div class="col-6 col-md-2">
    <label class="form-label text-warning fw-semibold">Min Rating</label>
    <select name="min_rating" class="form-select bg-dark text-light border-secondary">
      <option value="">Any</option>
      {% for r in "12345"|make_list %}
      <option value="{{ r }}" {% if request.GET.min_rating == r %}selected{% endif %}>
        {{ r }}+
      </option>
      {% endfor %}
    </select>
  </div>

  <!-- Group -->
  <div class="col-6 col-md-3">
    <label class="form-label text-warning fw-semibold">Group</label>
    <select name="group" class="form-select bg-dark text-light border-secondary">
      <option value="">Any</option>
      {% for key, value in group_choices %}
      <option value="{{ key }}" {% if request.GET.group == key %}selected{% endif %}>
        {{ value }}
      </option>
      {% endfor %}
    </select>
  </div>

  <!-- Max Cost -->
  <div class="col-6 col-md-2">
    <label class="form-label text-warning fw-semibold">Max Cost (£)</label>
    <input
      type="number"
      name="max_cost"
      value="{{ request.GET.max_cost }}"
      class="form-control bg-dark text-light border-secondary"
      placeholder="e.g. 100"
    />
  </div>

  <!-- Submit Button -->
  <div class="col-6 col-md-1 d-grid">
    <button class="btn btn-outline-warning btn-lg fw-semibold" type="submit">
      <i class="bi bi-funnel-fill me-1"></i> Go
    </button>
  </div>
</form>


<!-- EVENTS GRID -->
<div class="row g-4">
  {% for event in events %}
  <div class="col-12 col-md-6 col-lg-4">
    <div class="card h-100">
      {% if event.image %}
      <div class="position-relative">
        <img src="{{ event.image.url }}" class="card-img-top rounded-top object-fit-cover" alt="{{ event.title }}">
        <div class="position-absolute top-0 end-0 m-2 bg-warning text-dark fw-bold rounded-circle d-flex align-items-center justify-content-center shadow" style="width: 60px; height: 60px;">
          £{{ event.cost|floatformat:0 }}
        </div>
      </div>
      {% else %}
      {% endif %}
      <div class="card-body d-flex flex-column">

        <h5
          class="card-title mb-2 fw-bold text-warning"
          style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; min-height: calc(1.2em * 2); line-height: 1.2em;"
        >
          {{ event.title }}
        </h5>
        <div class="d-flex justify-content-between text-secondary small mb-2">
          <span>{{ event.location }}</span>
          <span>⭐ {{ event.rating }}</span>
        </div>

        <p
          class="card-text text-light flex-grow-1"
          style="display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;"
        >
          {{ event.description }}
        </p>

        <div class="mt-3 row">
          <a
            href="{% url 'event_detail' event.id %}"
            class="btn btn-outline-warning btn-sm btn-block mx-auto w-50"
          >
            View Details
          </a>
        </div>
      </div>
    </div>
  </div>
  {% empty %}
  <p>No events match your filters.</p>
  {% endfor %}
</div>

<!-- PAGINATION -->
{% if is_paginated %}
  <div class="pagination justify-content-center mt-4">
    {% if page_obj.has_previous %}
      <a class="btn btn-outline-warning me-2"
         href="?page={{ page_obj.previous_page_number }}{% for k, v in request.GET.items %}{% if k != 'page' and v %}&{{ k }}={{ v }}{% endif %}{% endfor %}">
        Previous
      </a>
    {% endif %}

    <span class="btn btn-outline-warning disabled">
      Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </span>

    {% if page_obj.has_next %}
      <a class="btn btn-outline-warning ms-2"
         href="?page={{ page_obj.next_page_number }}{% for k, v in request.GET.items %}{% if k != 'page' and v %}&{{ k }}={{ v }}{% endif %}{% endfor %}">
        Next
      </a>
    {% endif %}
  </div>
{% endif %}

<div class="row"><br /></div>

{% endblock %}
